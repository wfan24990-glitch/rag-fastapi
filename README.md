# RAG FastAPI System (Full Stack)

è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„ RAG (Retrieval-Augmented Generation) ç³»ç»Ÿï¼ŒåŒ…å«é«˜æ€§èƒ½çš„ FastAPI åç«¯ã€ç°ä»£åŒ–çš„ Vue 3 å‰ç«¯ä»¥åŠæ™ºèƒ½å¢é‡çˆ¬è™«æ¨¡å—ã€‚

è¯¥é¡¹ç›®ä¸ä»…å®ç°äº†æ ‡å‡†çš„ RAG æµç¨‹ï¼ˆåˆ†å—ã€åµŒå…¥ã€æ£€ç´¢ã€é‡æ’åºã€ç”Ÿæˆï¼‰ï¼Œè¿˜æä¾›äº†ä¸€ä¸ªå¯è§†åŒ–çš„ç®¡ç†ç•Œé¢ï¼Œç”¨äºç›‘æ§çˆ¬è™«çŠ¶æ€ã€è°ƒè¯•æ£€ç´¢é“¾è·¯ä»¥åŠç®¡ç†çŸ¥è¯†åº“ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ§  æ ¸å¿ƒ RAG å¼•æ“
- **é«˜æ€§èƒ½æ¶æ„**: åŸºäº FastAPI å¼‚æ­¥æ¡†æ¶ã€‚
- **å…ˆè¿›æ£€ç´¢é“¾è·¯**:
  - **Embedding**: é›†æˆ `BAAI/bge-small-zh-v1.5`ï¼Œæ”¯æŒé«˜è´¨é‡ä¸­æ–‡è¯­ä¹‰å‘é‡åŒ–ã€‚
  - **Vector Store**: ä½¿ç”¨ FAISS è¿›è¡Œæ¯«ç§’çº§å‘é‡æ£€ç´¢ã€‚
  - **Reranking**: é›†æˆ `BAAI/bge-reranker-base` å¯¹æ£€ç´¢ç»“æœè¿›è¡Œè¯­ä¹‰é‡æ’åºï¼Œå¤§å¹…æå‡ä¸Šä¸‹æ–‡ç›¸å…³æ€§ã€‚
- **æ™ºèƒ½é—®ç­”**: è‡ªåŠ¨æ„å»º Promptï¼Œæ”¯æŒè±†åŒ… (Doubao) æ¨¡å‹ï¼Œå¹¶å…·å¤‡ OpenAI è‡ªåŠ¨é™çº§å®¹é”™æœºåˆ¶ã€‚

### ğŸ•·ï¸ æ™ºèƒ½å¢é‡çˆ¬è™«
- **ç›®æ ‡æº**: ä¸“ä¸ºå—äº¬å¤§å­¦æ™ºèƒ½ç§‘å­¦ä¸æŠ€æœ¯å­¦é™¢ (`is.nju.edu.cn`) å®šåˆ¶ã€‚
- **å¢é‡æ›´æ–°**: æ™ºèƒ½è¯†åˆ«ä¸Šæ¬¡åŒæ­¥æ—¶é—´ï¼Œä»…æŠ“å–æ–°å‘å¸ƒçš„æ–‡ç« ï¼ŒèŠ‚çœèµ„æºã€‚
- **å¥å£®æ€§è®¾è®¡**:
  - å†…ç½® `tenacity` æŒ‡æ•°é€€é¿é‡è¯•æœºåˆ¶ã€‚
  - å…¼å®¹è€æ—§ SSL åè®®ï¼ˆè§£å†³æ ¡å›­ç½‘æ¡æ‰‹å¤±è´¥é—®é¢˜ï¼‰ã€‚
  - URL ä¸ å†…å®¹åŒé‡å»é‡ (Hash-based Deduplication)ã€‚
- **Dry Run æ¨¡å¼**: æ”¯æŒâ€œç©ºè·‘â€æµ‹è¯•ï¼Œä»…æ¨¡æ‹ŸæŠ“å–æµç¨‹è€Œä¸å†™å…¥æ•°æ®åº“ï¼Œä¾¿äºéªŒè¯ã€‚

### ğŸ–¥ï¸ å¯è§†åŒ–å‰ç«¯
- **æŠ€æœ¯æ ˆ**: Vue 3 + Vite + Element Plusã€‚
- **çˆ¬è™«ç®¡ç†**: å¯è§†åŒ–è§¦å‘å…¨é‡/å¢é‡çˆ¬å–ï¼Œå®æ—¶æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ã€æ–°å¢æ¡æ•°åŠé”™è¯¯æ—¥å¿—ã€‚
- **è°ƒè¯•æ§åˆ¶å°**:
  - **å…¨é“¾è·¯é€è§†**: å±•ç¤º Embeddingã€Searchã€Rerankã€Generation å„é˜¶æ®µè€—æ—¶ã€‚
  - **æ£€ç´¢å¯¹æ¯”**: ç›´è§‚å¯¹æ¯”â€œåˆæ’å€™é€‰â€ä¸â€œé‡æ’åä¸Šä¸‹æ–‡â€ï¼Œè¾…åŠ©è°ƒä¼˜ã€‚

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **Backend**: Python 3.10, FastAPI, Uvicorn, Aiohttp, BeautifulSoup4
- **AI/ML**: PyTorch, Transformers, Sentence-Transformers, FAISS
- **Frontend**: Vue 3, Vite, Element Plus, Axios
- **Infrastructure**: Conda, Docker (Optional)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿å·²å®‰è£…ï¼š
- Python 3.10+ (æ¨èä½¿ç”¨ Conda)
- Node.js 18+

### 2. åç«¯è®¾ç½®

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/wfan24990-glitch/rag-fastapi.git
cd rag-fastapi

# 2. åˆ›å»ºå¹¶æ¿€æ´» Conda ç¯å¢ƒ
conda create -n rag python=3.10
conda activate rag

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. é…ç½®ç¯å¢ƒå˜é‡
# å¤åˆ¶ .env.example ä¸º .env å¹¶å¡«å…¥ API Key
cp .env.example .env
```

**`.env` é…ç½®ç¤ºä¾‹**:
```ini
LLM_API_KEY=your_doubao_api_key
LLM_PROVIDER=doubao
OPENAI_API_KEY=your_openai_key (å¯é€‰ï¼Œç”¨äºé™çº§)
```

### 3. å‰ç«¯è®¾ç½®

```bash
cd frontend

# å®‰è£…ä¾èµ–
npm install
```

### 4. å¯åŠ¨æœåŠ¡

**å¯åŠ¨åç«¯**:
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
conda activate rag
uvicorn app.main:app --reload --host 0.0.0.0 --port 8001
```

**å¯åŠ¨å‰ç«¯**:
```bash
# åœ¨ frontend ç›®å½•
npm run dev
```

è®¿é—®å‰ç«¯é¡µé¢ï¼š`http://localhost:5173`

## ğŸ“– ä½¿ç”¨æŒ‡å—

### 1. çˆ¬è™«ç®¡ç† (Crawler Manager)
åœ¨å‰ç«¯é¡¶éƒ¨é¢æ¿ï¼š
- ç‚¹å‡» **"Dry Run"**ï¼šæµ‹è¯•çˆ¬è™«é€»è¾‘ï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼Œä¸å†™å…¥æ•°æ®ã€‚
- ç‚¹å‡» **"Incremental Update"**ï¼šå¼€å§‹å¢é‡æŠ“å–ï¼Œå°†æ–°æ–‡ç« è‡ªåŠ¨å‘é‡åŒ–å¹¶å­˜å…¥ FAISSã€‚
- ç‚¹å‡» **"Full Crawl"**ï¼šé‡æ–°æŠ“å–å‰ 50 é¡µæ•°æ®ï¼ˆç”¨äºåˆå§‹åŒ–æˆ–ä¿®å¤æ•°æ®ï¼‰ã€‚

### 2. RAG è°ƒè¯• (Debug Console)
åœ¨å‰ç«¯ä¸‹æ–¹æœç´¢æ¡†ï¼š
- è¾“å…¥é—®é¢˜ï¼ˆä¾‹å¦‚ï¼šâ€œ2025å¹´æ‹›è˜å…¬å‘Šâ€ï¼‰ã€‚
- æŸ¥çœ‹ **Timings** é¢æ¿ï¼Œåˆ†æå„é˜¶æ®µè€—æ—¶ã€‚
- åˆ‡æ¢ **Retrieval Process** æ ‡ç­¾é¡µï¼ŒæŸ¥çœ‹ Rerank å‰åçš„æ–‡æ¡£å·®å¼‚ã€‚

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
rag-fastapi/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api.py              # API è·¯ç”± (å« /query, /ingest, /crawler)
â”‚   â”œâ”€â”€ crawler/            # çˆ¬è™«æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ spider.py       # çˆ¬è™«æ ¸å¿ƒé€»è¾‘ (Aiohttp + Tenacity)
â”‚   â”‚   â”œâ”€â”€ parser.py       # ç½‘é¡µè§£æå™¨ (BeautifulSoup)
â”‚   â”‚   â””â”€â”€ state.py        # çŠ¶æ€ç®¡ç† (JSON)
â”‚   â”œâ”€â”€ embeddings.py       # Embedding æ¨¡å‹å°è£…
â”‚   â”œâ”€â”€ vectorstore.py      # FAISS å‘é‡åº“å°è£…
â”‚   â”œâ”€â”€ reranker.py         # Reranker æ¨¡å‹å°è£…
â”‚   â””â”€â”€ llm.py              # LLM è°ƒç”¨é€»è¾‘
â”œâ”€â”€ frontend/               # Vue 3 å‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/components/     # ç»„ä»¶ (CrawlerManager, RAGDebug)
â”‚   â””â”€â”€ ...
â”œâ”€â”€ data/                   # æ•°æ®å­˜å‚¨ (FAISSç´¢å¼•, çˆ¬è™«çŠ¶æ€)
â”œâ”€â”€ requirements.txt        # Python ä¾èµ–
â””â”€â”€ README.md               # é¡¹ç›®æ–‡æ¡£
```

## ğŸ“„ License

MIT License
